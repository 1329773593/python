## 表格数据

```python
import pandas as pd 

dftrain_raw = pd.read_csv('./eat_pytorch_datasets/titanic/train.csv')
dftest_raw = pd.read_csv('./eat_pytorch_datasets/titanic/test.csv')
```

## 图像数据

```python
from torchvision import transforms as T
from torchvision import datasets 

transform_img = T.Compose(
    [T.ToTensor()])

def transform_label(x):
    return torch.tensor([x]).float()


ds_train = datasets.ImageFolder("./eat_pytorch_datasets/cifar2/train/",
            transform = transform_img,target_transform = transform_label)
ds_val = datasets.ImageFolder("./eat_pytorch_datasets/cifar2/test/",
            transform = transform_img,target_transform = transform_label)
```

### 1. `from torchvision import transforms as T`

`torchvision.transforms` 是一个用来进行图像预处理的模块，提供了多种常用的图像转换操作。我们通过 `T` 来简化代码中的调用。

```python
from torchvision import transforms as T
```

### 2. `T.Compose([T.ToTensor()])`

`T.Compose` 是一个容器，用于将多个图像转换操作组合成一个流水线，以便依次应用每个转换。在这里，我们用 `T.Compose` 组合了一个单一的转换：`T.ToTensor()`。

#### `T.Compose` 用法

`T.Compose` 允许你将多个转换按顺序链式应用于图像。在应用于数据集时，它会依次对每张图片进行转换。

**示例**：

```python
transform = T.Compose([
    T.Resize(256),    # 将图像大小调整为 256x256
    T.CenterCrop(224), # 从中心裁剪出 224x224 的区域
    T.ToTensor(),     # 将图片转换为 Tensor
    T.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])  # 归一化
])
```

- `T.Resize(256)`：将图片的短边调整为 256px，长边按比例缩放。
- `T.CenterCrop(224)`：裁剪图片中心的 224x224 区域。
- `T.ToTensor()`：将图片从 `PIL` 或 `numpy` 数组格式转换为 `Tensor`，并将像素值归一化到 `[0, 1]` 范围。
- `T.Normalize(mean, std)`：对 Tensor 图像进行归一化处理，使得每个通道的均值为 `mean`，标准差为 `std`。

#### `T.ToTensor` 用法

`T.ToTensor()` 会将输入的图片转换为一个 `torch.Tensor`，并且它会将图片的像素值归一化到 `[0, 1]` 范围内。

**示例**：

```python
from PIL import Image
image = Image.open("example.jpg")
tensor_image = T.ToTensor()(image)
```

- 输入：`PIL` 图像或 `numpy` 数组。
- 输出：`torch.Tensor`，形状为 `(C, H, W)`，`C` 是通道数，`H` 是高度，`W` 是宽度。

### 3. `def transform_label(x): return torch.tensor([x]).float()`

这个函数用于将类别标签 `x` 转换为浮动型的 tensor。在分类任务中，标签通常是整数类型，但我们可能需要将其转换为浮动类型 tensor，特别是当进行某些损失计算或与网络输出对比时。

#### `torch.tensor` 用法

`torch.tensor` 是 PyTorch 中的一个基础方法，用于从 Python 列表、数组、numpy 数组等数据结构创建 tensor。

**示例**：

```python
label = 2  # 假设标签是 2
tensor_label = torch.tensor([label]).float()
```

- `torch.tensor([x])`：将数字 `x` 包装成一个 tensor。这里的 `[x]` 会将其变为一个包含 `x` 的列表，从而创建一个一维 tensor。
- `.float()`：将 tensor 转换为浮动类型 (`float32`)，以确保在计算时使用浮动数据类型。

输出结果为：

```python
tensor_label = tensor([2.])
```

### 4. `datasets.ImageFolder`

`datasets.ImageFolder` 是一个 PyTorch 的数据集类，用于从文件夹中加载图像数据。它假设文件夹的结构如下：

```
root/dog/xxx.png
root/cat/yyy.png
```

每个子文件夹名会被视为该文件夹下图片的标签。

#### `ImageFolder` 用法

`datasets.ImageFolder` 用于从磁盘上加载图像数据集，并且自动为每个文件夹分配标签。

**示例**：

```python
from torchvision import datasets

# 定义数据集路径
train_dataset = datasets.ImageFolder(root='./data/train', transform=transform_img, target_transform=transform_label)
```

- `root`：数据集所在的根目录。
- `transform`：图像转换操作，通常使用 `T.Compose` 对图像进行预处理（例如缩放、裁剪、归一化等）。
- `target_transform`：标签转换操作，将图像标签转换为所需的格式。在这里，我们使用 `transform_label` 将标签转换为浮动类型 tensor。

#### 数据加载

通过 `ImageFolder` 创建的数据集对象，具有以下属性：

- `.imgs`：包含图像文件路径和标签的列表。
- `.targets`：图像对应的标签列表。

**获取一张图片和标签**：

```python
img, label = train_dataset[0]  # 获取第一张图片和标签
print(img.shape)  # 输出图片的尺寸，如 [3, 224, 224]
print(label)      # 输出标签，如 0 或 1
```

### 5. 数据集分配

- `ds_train = datasets.ImageFolder("./eat_pytorch_datasets/cifar2/train/", transform=transform_img, target_transform=transform_label)`
   这行代码加载了训练集数据，图像经过 `transform_img` 转换（`T.ToTensor()`），标签经过 `transform_label` 转换（转为浮动型 tensor）。
- `ds_val = datasets.ImageFolder("./eat_pytorch_datasets/cifar2/test/", transform=transform_img, target_transform=transform_label)`
   这行代码加载了验证集数据，同样应用了图像和标签转换。

### 总结

#### 各函数的功能：

- `T.Compose`：将多个图像转换操作组合成一个转换流水线。
- `T.ToTensor`：将图像从 PIL 或 numpy 数组格式转换为 PyTorch 的 tensor 格式，并将像素值归一化到 `[0, 1]`。
- `torch.tensor`：将标签转换为 tensor 格式。
- `datasets.ImageFolder`：从目录中加载图像数据，自动将文件夹名称作为标签，并将每个图像和标签组合在一起。

#### 代码流程：

1. 图像经过 `T.ToTensor()` 转换为 tensor 格式。
2. 标签通过自定义的 `transform_label` 函数转换为浮动型的 tensor。
3. 使用 `datasets.ImageFolder` 加载训练集和验证集图像数据，并将转换应用到数据集中。

这样，数据就可以方便地用于后续的训练或验证过程。

## 文本数据

```python
from gensim import corpora
import string
import pandas as pd 

dftrain = pd.read_csv("./eat_pytorch_datasets/imdb/train.tsv",sep="\t",header = None,names = ["label","text"])
dfval = pd.read_csv("./eat_pytorch_datasets/imdb/test.tsv",sep="\t",header = None,names = ["label","text"])
```

------

### 1. `string.punctuation`

- **作用**：Python内置字符串常量，包含所有英文标点符号
- **值**：`!"#$%&'()*+,-./:;<=>?@[\]^_`{|}~`
- **使用场景**：用于创建移除标点的转换表

------

### 2. `str.maketrans(x, y, z)`

- **作用**：创建字符映射转换表

- 参数：

  - `x`：要替换的字符（字符串）
  - `y`：替换后的字符（字符串）
  - `z`：要删除的字符（字符串）

- 本例用法：

  ```
  str.maketrans('', '', string.punctuation)
  ```

  - 创建删除所有标点的转换表

- **输出**：转换字典（供`translate()`使用）

------

### 3. `str.translate(table)`

- **作用**：根据转换表处理字符串

- 参数：

  - `table`：由`maketrans()`创建的转换表

- 本例用法：

  ```
  text.translate(translator)
  ```

  - 删除文本中所有标点符号

- **输出**：处理后的字符串

------

### 4. `str.split(sep=None, maxsplit=-1)`

- **作用**：分割字符串为列表

- 参数：

  - `sep`：分隔符（默认空格）
  - `maxsplit`：最大分割次数（默认全部分割）

- 本例用法：

  ```
  text.split(' ')
  ```

  - 按空格分割文本

- **输出**：单词列表

------

### 5. `corpora.Dictionary(documents)`

- **库**：`gensim.corpora`

- **作用**：从文档集合创建词典

- 参数：

  - `documents`：可迭代对象，每个元素是单词列表

- 本例用法：

  ```
  corpora.Dictionary((textsplit(text) for text in dftrain['text']))
  ```

  - 从训练集文本构建词典

- **输出**：词典对象（包含单词到ID的映射）

------

### 6. `Dictionary.filter_extremes(no_below=None, no_above=None, keep_n=None, keep_tokens=None)`

- **作用**：过滤词典中的词汇

- 参数：

  - `no_below`：保留出现次数≥该值的词
  - `no_above`：保留出现次数≤该值的词（或文档频率≤该比例）
  - `keep_n`：保留最多前N个高频词
  - `keep_tokens`：强制保留的词列表

- 本例用法：

  ```
  vocab.filter_extremes(no_below=5, no_above=5000)
  ```

  - 移除出现少于5次或多于5000次的词

- **输出**：更新后的词典（原地修改）

------

### 7. `Dictionary.patch_with_special_tokens(special_tokens)`

- **作用**：添加特殊标记到词典

- 参数：

  - `special_tokens`：字典{标记: ID}

- 本例用法：

  ```
  vocab.patch_with_special_tokens({'<pad>':0, '<unk>':1})
  ```

  - 添加填充标记`<pad>`和未知词标记`<unk>`

- **输出**：更新后的词典（原地修改）

------

### 8. `Dictionary.token2id`

- **作用**：获取单词到ID的映射字典

- 输出：

  ```
  {'<pad>':0, '<unk>':1, 'the':2, ...}
  ```

- 本例用法：

  ```
  len(vocab.token2id)  # 获取词典大小
  ```

------

### 9. `Dictionary.doc2idx(doc)`

- **作用**：将文档（单词列表）转换为ID列表
- 参数：
  - `doc`：单词列表
- 处理：
  - 已知词 → 对应ID
  - 未知词 → -1
- **输出**：整数列表（包含-1表示未知词）

------

### 10. `len(object)`

- **作用**：返回对象长度

- 本例用法：

  ```
  len(seq)  # 获取序列长度
  len(vocab.token2id)  # 获取词典大小
  ```

- **输出**：整数

------

### 11. 列表推导式 `[expression for item in iterable if condition]`

- **作用**：创建新列表

- 本例用法：

  ```
  [x if x>0 else special_tokens['<unk>'] for x in tokens]
  ```

  - 遍历ID列表
  - 保留有效ID（>0）
  - 将-1（未知词）替换为`<unk>`的ID

------

### 12. 列表加法 `list1 + list2`

- **作用**：连接两个列表

- 本例用法：

  ```
  seq + [pad_value]*max_length
  ```

  - 原始序列 + 填充值列表

- **输出**：新列表（长度=len(seq)+max_length）

------

### 13. 列表切片 `list[start:stop]`

- **作用**：获取列表子集

- 本例用法：

  ```
  result[:max_length]
  ```

  - 截取前max_length个元素

- **输出**：新列表（长度≤max_length）

------

### 关键函数总结

| 函数                        | 库/类型    | 关键参数          | 输出     | 主要作用     |
| --------------------------- | ---------- | ----------------- | -------- | ------------ |
| `str.maketrans`             | Python内置 | (x,y,z)           | 转换表   | 创建字符映射 |
| `str.translate`             | Python内置 | table             | 字符串   | 应用字符转换 |
| `str.split`                 | Python内置 | sep               | 列表     | 分割字符串   |
| `corpora.Dictionary`        | gensim     | documents         | 词典对象 | 创建词典     |
| `filter_extremes`           | gensim     | no_below,no_above | None     | 过滤词典     |
| `patch_with_special_tokens` | gensim     | special_tokens    | None     | 添加特殊标记 |
| `doc2idx`                   | gensim     | doc               | 整数列表 | 单词转ID     |
| 列表推导式                  | Python语法 | -                 | 新列表   | 处理未知词   |
| 列表加法                    | Python语法 | -                 | 新列表   | 准备填充     |
| 列表切片                    | Python语法 | [start:stop]      | 子列表   | 截断序列     |
