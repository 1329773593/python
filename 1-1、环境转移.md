# Windows ç³»ç»Ÿé—´ Python è™šæ‹Ÿç¯å¢ƒè¿ç§»æŒ‡å—ï¼ˆRequirements.txt æ–¹æ³•ï¼‰
ğŸ–¥ï¸ å®Œæ•´è¿ç§»æµç¨‹ (Windows åˆ° Windows)

è¿ç§»å‰å‡†å¤‡ (æºç”µè„‘)

1. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼š
   # æ‰“å¼€ PowerShell
   Set-ExecutionPolicy RemoteSigned -Scope CurrentUser  # è‹¥éœ€è¦
   cd C:\path\to\project
   .\venv\Scripts\activate
   

2. ç”Ÿæˆä¼˜åŒ–çš„ requirements.txtï¼š
   pip install pip-tools
   pip-compile --output-file requirements.txt
   
   # å¤‡é€‰ï¼šæ ‡å‡†å¯¼å‡ºæ–¹æ³•
   pip freeze > requirements.txt
   

3. è®°å½•ç¯å¢ƒä¿¡æ¯ï¼š
   "Pythonç‰ˆæœ¬: $(& {python --version} 2>&1)" > env_info.txt
   "ç³»ç»Ÿæ¶æ„: $([System.Environment]::Is64BitOperatingSystem ? '64ä½' : '32ä½')" >> env_info.txt
   "Windowsç‰ˆæœ¬: $([System.Environment]::OSVersion.Version)" >> env_info.txt
   

4. æ¸…ç†ä¸´æ—¶æ–‡ä»¶ï¼š
   Remove-Item -Force -Recurse __pycache__  -ErrorAction SilentlyContinue
   Remove-Item -Force -Recurse .pytest_cache -ErrorAction SilentlyContinue
   

ğŸ“¦ æ‰“åŒ…ä¼ è¾“æ–‡ä»¶

1. åˆ›å»ºè¿ç§»åŒ…ï¼š
   # åˆ›å»ºå¿…è¦çš„æ–‡ä»¶å¤¹ç»“æ„
   New-Item -ItemType Directory -Path ".\migration_package"
   Move-Item requirements.txt, env_info.txt, .\src\ -Destination .\migration_package
   
   # å‹ç¼©æ–‡ä»¶ (éœ€è¦å®‰è£… 7-Zip)
   & "C:\Program Files\7-Zip\7z.exe" a -tzip project_env.zip .\migration_package\*
   

2. ä¼ è¾“æ–¹å¼ï¼š
   â€¢ ç›´æ¥å¤åˆ¶ ZIP æ–‡ä»¶åˆ°Uç›˜/ç§»åŠ¨ç¡¬ç›˜

   â€¢ ä½¿ç”¨ OneDrive/Google Drive äº‘å­˜å‚¨

   â€¢ å±€åŸŸç½‘å…±äº« (\\ç›®æ ‡ç”µè„‘\å…±äº«æ–‡ä»¶å¤¹)

ğŸ§© ç›®æ ‡ç”µè„‘é…ç½®

1. å‡†å¤‡ Python ç¯å¢ƒï¼š
   # æŸ¥çœ‹æºç”µè„‘çš„ Python ç‰ˆæœ¬
   Get-Content .\env_info.txt
    
   # å®‰è£…åŒ¹é…çš„ Python (ä» python.org ä¸‹è½½)
   # ä¾‹å¦‚ï¼šå®‰è£… Python 3.10
   # å‹¾é€‰ "Add Python to PATH" å’Œ "Install for all users"
   

2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼š
   cd C:\path\to\project
   python -m venv .\venv
   .\venv\Scripts\activate
   

3. å®‰è£…ä¾èµ–ï¼š
   # åŸºç¡€ä¾èµ–
   pip install --upgrade pip setuptools wheel
    
   # ä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿå®‰è£…
   pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
    
   # å¤„ç†å¸¸è§Windowsé—®é¢˜
   pip install --only-binary :all: pypiwin32
   

ğŸ§ª ç¯å¢ƒéªŒè¯

1. åŸºç¡€æ£€æŸ¥ï¼š
   # éªŒè¯Pythonç¯å¢ƒ
   python -c "import sys; print(sys.prefix)"
   
   # æ£€æŸ¥å…³é”®åŒ…
   python -c "import numpy; print(numpy.__version__)"
   

2. åˆ›å»ºéªŒè¯è„šæœ¬ verify_env.pyï¼š
   import sys
   import subprocess
   import importlib.metadata as metadata
   
   def verify_environment():
       print(f"Pythonç‰ˆæœ¬: {sys.version}")
       print(f"è™šæ‹Ÿç¯å¢ƒè·¯å¾„: {sys.prefix}")
       
       required = ['numpy', 'pandas', 'requests']  # æ›¿æ¢ä¸ºä½ çš„å…³é”®ä¾èµ–
       errors = []
       
       for pkg in required:
           try:
               version = metadata.version(pkg)
               print(f"âœ… {pkg} å·²å®‰è£… ({version})")
           except metadata.PackageNotFoundError:
               errors.append(f"âŒ {pkg} æœªå®‰è£…")
       
       if not errors:
           print("\nâœ… ç¯å¢ƒéªŒè¯é€šè¿‡ï¼")
           sys.exit(0)
       else:
           print("\nâš  ç¯å¢ƒéªŒè¯å¤±è´¥:")
           for error in errors:
               print(error)
           sys.exit(1)
   
   if __name__ == "__main__":
       verify_environment()
   

3. è¿è¡ŒéªŒè¯ï¼š
   python verify_env.py
   

ğŸ›  Windows ç‰¹æœ‰è§£å†³æ–¹æ¡ˆ

å¸¸è§é—®é¢˜è§£å†³

é—®é¢˜ è§£å†³æ–¹æ¡ˆ

æ— æ³•æ¿€æ´»ç¯å¢ƒ Set-ExecutionPolicy RemoteSigned

ç¼ºå¤±DLL å®‰è£… https://aka.ms/vs/16/release/vc_redist.x64.exe

pip å®‰è£…å¤±è´¥ pip --no-cache-dir install <åŒ…å>

æƒé™é—®é¢˜ ç”¨ç®¡ç†å‘˜æƒé™è¿è¡Œ PowerShell

è·¯å¾„å¤ªé•¿é”™è¯¯ å¯ç”¨ Windows é•¿è·¯å¾„æ”¯æŒ

æ‰¹å¤„ç†è„šæœ¬ç¤ºä¾‹ (setup.bat)

@echo off
REM Windowsè™šæ‹Ÿç¯å¢ƒè‡ªåŠ¨è®¾ç½®è„šæœ¬

echo æ­£åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ...
python -m venv venv

echo æ­£åœ¨æ¿€æ´»ç¯å¢ƒ...
call .\venv\Scripts\activate

echo æ›´æ–°pip...
python -m pip install --upgrade pip

echo å®‰è£…ä¾èµ–...
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

echo éªŒè¯ç¯å¢ƒ...
python verify_env.py

echo ç¯å¢ƒè®¾ç½®å®Œæˆ!
pause


ğŸ“‚ ç›®å½•ç»“æ„ä¼˜åŒ–å»ºè®®


C:\projects\my_project\
â”œâ”€â”€ venv\                    # è™šæ‹Ÿç¯å¢ƒ
â”œâ”€â”€ src\                     # é¡¹ç›®æºä»£ç 
â”œâ”€â”€ data\                    # æ•°æ®æ–‡ä»¶
â”œâ”€â”€ requirements.txt         # ä¾èµ–æ–‡ä»¶
â”œâ”€â”€ env_info.txt             # ç¯å¢ƒä¿¡æ¯
â”œâ”€â”€ verify_env.py            # ç¯å¢ƒéªŒè¯è„šæœ¬
â””â”€â”€ setup.bat                # ä¸€é”®å®‰è£…è„šæœ¬


ğŸ’¾ è¿ç§»æ–‡ä»¶åŒ…å†…å®¹

1. requirements.txt - ä¾èµ–æ¸…å•
2. env_info.txt - Pythonç‰ˆæœ¬å’Œç³»ç»Ÿä¿¡æ¯
3. src/ - é¡¹ç›®æºä»£ç 
4. å…¶ä»–é…ç½®æ–‡ä»¶ (å¦‚ .env, settings.ini)

â± é«˜æ•ˆè¿ç§»æŠ€å·§

1. å¤§æ–‡ä»¶å¤„ç†ï¼š
   # åˆ›å»º.pipcacheæ–‡ä»¶å¤¹ç¼“å­˜ä¸‹è½½åŒ…
   pip install --cache-dir .pip-cache -r requirements.txt
   
   # å¤åˆ¶æ•´ä¸ªç¼“å­˜ç›®å½•åˆ°ç›®æ ‡ç”µè„‘
   
   
2. ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼š
   # ä»£ç ä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„
   import os
   DATA_DIR = os.path.join(os.path.dirname(__file__), 'data')
   

3. ç‰ˆæœ¬å†²çªå¤„ç†ï¼š
   # å®‰è£…æŒ‡å®šç‰ˆæœ¬
   pip install package_name==1.2.3
   
   # æ˜¾ç¤ºä¾èµ–æ ‘
   pipdeptree --reverse
   

ğŸ“¦ å¤‡é€‰è¿ç§»æ–¹æ³•

graph TD
    A[Windowsæºç¯å¢ƒ] -->|é¦–é€‰| B(requirements.txt)
    B --> C[Windowsç›®æ ‡ç¯å¢ƒ]
    A -->|æ¬¡é€‰| D(ç›´æ¥å¤åˆ¶venv)
    A -->|é«˜çº§| E(Dockerå®¹å™¨)


ç›´æ¥å¤åˆ¶ç¯å¢ƒ (ä¸æ¨è)

# 1. å¤åˆ¶æ•´ä¸ªvenvç›®å½•
# 2. åœ¨ç›®æ ‡ç”µè„‘ä¸Šè¿è¡Œä¿®å¤è„šæœ¬:
Get-ChildItem -Path .\venv\Scripts\*.exe -Recurse | Unblock-File


Dockeræ–¹æ³• (é«˜çº§)

# Dockerfile
FROM python:3.10-windowsservercore
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY src/ /app
WORKDIR /app
CMD ["python", "main.py"]


ğŸ“… è¿ç§»åç»´æŠ¤å»ºè®®

1. æ›´æ–°ä¾èµ–ï¼š
   # æ›´æ–°requirements.txt
   pip-compile --upgrade
   
   
2. åˆ›å»ºè¿ç§»æ–‡æ¡£ï¼š

   migration_log.md è®°å½•è¿ç§»æ—¥æœŸã€é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ
   

3. è®¾ç½®å®šæœŸå¤‡ä»½ï¼š
   # æ¯å‘¨å¤‡ä»½ç¯å¢ƒé…ç½®
   $backupName = "env_backup_$(Get-Date -Format 'yyyyMMdd').zip"
   7z a $backupName requirements.txt env_info.txt
   

æœ¬æŒ‡å—é’ˆå¯¹ Windows ç‰¹æœ‰ç¯å¢ƒè®¾è®¡ï¼Œé€šè¿‡ requirements.txt æ–¹æ³•ç¡®ä¿è·¨ Windows ç³»ç»Ÿè¿ç§»çš„æˆåŠŸç‡å’Œä¸€è‡´æ€§ã€‚è¿ç§»åè¿è¡ŒéªŒè¯è„šæœ¬ç¡®ä¿ç¯å¢ƒå®Œæ•´æ€§ï¼Œè§£å†³å¸¸è§ Windows ç›¸å…³é—®é¢˜ã€‚
